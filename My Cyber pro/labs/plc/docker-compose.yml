name: plc-lab
networks:
  plc_network:
    driver: bridge

services:
  # OpenPLC Runtime
  openplc:
    image: openplcproject/openplc:latest
    container_name: plc_runtime
    networks:
      - plc_network
    ports:
      - "8081:8080"
      - "5021:502"
    environment:
      - OPENPLC_RUNTIME=true
    volumes:
      - plc-data:/workdir
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8080" ]
      interval: 30s
      timeout: 10s
      retries: 3

  # PLC Simulator
  plc-simulator:
    image: python:3.11-slim
    container_name: plc_simulator
    working_dir: /app
    networks:
      - plc_network
    volumes:
      - ./simulator:/app
    command: sh -c "pip install pymodbus && python simulator.py"
    depends_on:
      - openplc
    restart: unless-stopped

volumes:
  plc-data:
