name: pentest-lab
networks:
  pentest_network:
    driver: bridge

services:
  # Kali Linux Tools
  kali-tools:
    image: kalilinux/kali-rolling:latest
    container_name: pentest_kali
    networks:
      - pentest_network
    ports:
      - "8083:8080"
      - "4444:4444"
    environment:
      - DISPLAY=:0
    volumes:
      - pentest-data:/root
    command: sleep infinity
    restart: unless-stopped

  # Vulnerable ICS Target
  vulnerable-target:
    image: python:3.11-slim
    container_name: pentest_target
    working_dir: /app
    networks:
      - pentest_network
    ports:
      - "5022:502"
    volumes:
      - ./target:/app
    command: sh -c "pip install pymodbus flask && python vulnerable_service.py"
    restart: unless-stopped

  # Web Terminal for Kali
  web-terminal:
    image: wettyoss/wetty:latest
    container_name: pentest_terminal
    networks:
      - pentest_network
    ports:
      - "3001:3000"
    environment:
      - SSHHOST=kali-tools
      - SSHPORT=22
    depends_on:
      - kali-tools
    restart: unless-stopped

volumes:
  pentest-data:
