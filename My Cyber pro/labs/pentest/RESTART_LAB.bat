@echo off
echo ========================================
echo   Cleaning Up Old Pentest Containers
echo ========================================
echo.

REM Stop and remove old containers
echo Removing old pentest_kali container...
docker stop pentest_kali 2>nul
docker rm pentest_kali 2>nul

echo Removing any orphaned containers...
docker stop pentest-pentest-1 2>nul
docker rm pentest-pentest-1 2>nul

echo.
echo [OK] Cleanup complete
echo.

REM Start new lab
echo ========================================
echo   Starting Advanced Pentest Lab
echo ========================================
echo.

docker-compose up -d

if %errorlevel% neq 0 (
    echo [ERROR] Failed to start lab
    pause
    exit /b 1
)

echo.
echo ========================================
echo   Lab Started Successfully!
echo ========================================
echo.
echo Waiting for services to initialize (30 seconds)...
timeout /t 30 /nobreak >nul

echo.
echo Container Status:
docker ps --filter "name=pentest" --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"

echo.
echo ========================================
echo Access Points:
echo   • Attacker Terminal:  http://localhost:7681
echo   • DVWA Target:        http://localhost:8081
echo   • Juice Shop Target:  http://localhost:3000
echo ========================================
echo.
pause
