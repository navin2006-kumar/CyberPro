@echo off
echo ========================================
echo   Advanced Pentest Lab - Quick Start
echo ========================================
echo.

REM Check if Docker is running
echo [1/4] Checking Docker...
docker ps >nul 2>&1
if %errorlevel% neq 0 (
    echo [ERROR] Docker is not running!
    echo Please start Docker Desktop and try again.
    pause
    exit /b 1
)
echo [OK] Docker is running
echo.

REM Stop any existing pentest containers
echo [2/4] Cleaning up old containers...
docker stop pentest_attacker pentest_dvwa pentest_juice 2>nul
docker rm pentest_attacker pentest_dvwa pentest_juice 2>nul
echo [OK] Cleanup complete
echo.

REM Build and start all containers
echo [3/4] Building and starting lab...
echo This may take 5-10 minutes on first run (downloading images and building)
echo.
docker-compose up -d --build

if %errorlevel% neq 0 (
    echo [ERROR] Failed to start lab
    echo.
    echo Troubleshooting:
    echo 1. Check Docker Desktop is running
    echo 2. Check ports 7681, 8081, 3000 are not in use
    echo 3. Try: docker-compose down then run this script again
    pause
    exit /b 1
)
echo [OK] Lab started successfully
echo.

REM Wait for containers to initialize
echo [4/4] Waiting for services to initialize...
timeout /t 10 /nobreak >nul
echo.

REM Show status
echo ========================================
echo   Lab is Ready!
echo ========================================
echo.
echo Access Points:
echo   • Attacker Terminal:  http://localhost:7681
echo   • DVWA Target:        http://localhost:8081
echo   • Juice Shop Target:  http://localhost:3000
echo.
echo Container Status:
docker ps --filter "name=pentest" --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
echo.
echo ========================================
echo Quick Start Guide:
echo ========================================
echo 1. Open attacker terminal: http://localhost:7681
echo 2. Run: discover.sh
echo 3. Start scanning targets!
echo.
echo Documentation:
echo   - README.md       - Exercises and learning path
echo   - SETUP_GUIDE.md  - Detailed setup and troubleshooting
echo.
echo ⚠️  EDUCATIONAL USE ONLY - Practice ethical hacking!
echo ========================================
echo.
pause
