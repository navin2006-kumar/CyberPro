FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    nmap \
    python3 \
    python3-pip \
    git \
    net-tools \
    iputils-ping \
    curl \
    wget \
    vim \
    openssh-server \
    netcat \
    tcpdump \
    && rm -rf /var/lib/apt/lists/*

# Install Python packages for OT/ICS
RUN pip3 install --no-cache-dir \
    pymodbus \
    scapy

# Setup SSH
RUN mkdir /var/run/sshd && \
    echo 'root:pentest' | chpasswd && \
    sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config

# Install web terminal (ttyd)
RUN curl -L https://github.com/tsl0922/ttyd/releases/download/1.7.3/ttyd.x86_64 -o /usr/local/bin/ttyd && \
    chmod +x /usr/local/bin/ttyd

COPY start.sh /start.sh
RUN chmod +x /start.sh

EXPOSE 22 7681

CMD ["/start.sh"]
